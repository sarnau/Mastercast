/*** *	einige kleiner Routinen ***/#include "Utilities.h"#include "GlobalLib.h"#include <Fonts.h>const RGBColor	cWhite = { 0xFFFF, 0xFFFF, 0xFFFF }, cBlack = { 0x0000, 0x0000, 0x0000 },				cSteelBlue = { 0xCCCC, 0xCCCC, 0xFFFF }, cDarkGray = { 0x4000, 0x4000, 0x4000 },				cMediumGray = { 0xAAAA, 0xAAAA, 0xAAAA };/*** *	Abfragen ob eine Taste _momentan_ gedrŸckt ist ***/Boolean		CheckKey(short keyCode){KeyMap		theKeys;		// 8 Byte Tastaturmatrix	GetKeys(theKeys);				// aktuelle Tastaturmatrik holen	return (((Ptr)&(theKeys))[(keyCode)>>3] & (1<<((keyCode) & 7)));}/*** *	aktuelle Fonteinstellungen retten bzw setzen ***/// ein Default-Font: System-Font, OR-Copymode, Default-Grš§e, kein spezieller StilFontStruct	fDefault = { 0,srcOr,0,0, { 0x0000, 0x0000, 0x0000}, { 0xFFFF, 0xFFFF, 0xFFFF}, blackColor, whiteColor };void		SaveText(FontStruct *f){	f->txFont = qd.thePort->txFont;	f->txMode = qd.thePort->txMode;	f->txSize = qd.thePort->txSize;	f->txFace = qd.thePort->txFace;	f->fgColor = qd.thePort->fgColor;	f->bkColor = qd.thePort->bkColor;	if(gQDVersion > 0) {		GetForeColor(&f->fGround);		GetBackColor(&f->bGround);	}}void		RestoreText(const FontStruct *f){	TextFont(f->txFont);	TextMode(f->txMode);	TextSize(f->txSize);	TextFace(f->txFace);	ForeColor(f->fgColor);	BackColor(f->bkColor);	if(gQDVersion > 0) {		RGBForeColor(&f->fGround);		RGBBackColor(&f->bGround);	}}/*** *	Font gemŠ§ einer TxSt-Resource einstellen ***/short			SetFont(short resid){typedef struct {		// TxSt-Resource-Format	Style		stil;	short		size;	RGBColor	color;	Str255		fontname;} TxStStruct;short			fontNum;Str255			systemFontName;TxStStruct		**txs;TxStStruct		*txp;	txs = (TxStStruct**)GetResource('TxSt', resid);	// Resource suchen	if(!txs || ResError()) {	error:		DebugStr("\pTxSt-Resource nicht gefunden!");		return 0;	}	HLock((Handle)txs);	txp = *txs;	GetFNum(txp->fontname, &fontNum);	// Nummer zu einem Fontnamen ermitteln	if(fontNum == 0) {						// Font 0 = System-Font bzw. Font nicht gefunden?		GetFontName(systemFont, systemFontName);	// Namen vom System-Font wŠhlen		if(!EqualString(txp->fontname, systemFontName, false, false))	// nicht der System-Font?			goto error;						// => raus	}	TextFont(fontNum);						// Font setzen	TextFace(txp->stil);					// Fontstil setzen	TextSize(txp->size);					// Fontgrš§e setzen	if(gQDVersion > 0)		RGBForeColor(&txp->color);			// RGB-Color setzen	HUnlock((Handle)txs);	ReleaseResource((Handle)txs);	FontInfo		fInfo;	GetFontInfo(&fInfo);	return fInfo.ascent + fInfo.descent + fInfo.leading;}/*** *	zwei Pascal-Strings verketten ***/void	ConcatPString(Str255 d,Str255 s){short		l;	if ((d[0]+s[0])>255)			// maximale StringlŠnge!		l = 255-d[0];				// nur bis maximal 255 Zeichen auffŸllen	else		l = s[0];					// gesamten String anhŠngen	if (l > 0) {					// Ÿberhaupt was zu kopieren?		BlockMoveData(s+1,d+d[0]+1,l);	// String dranhŠngen		d[0] += l;					// StringlŠnge hochsetzen	}}/*** *	Pascal-String auf einen anderen kopieren ***/void	CopyPString(Str255 d,Str255 s){	BlockMoveData(s,d,1+(long)s[0]);}/*** *	zwei Pascal-Strings auf Gleichheit testen ***/Boolean	ComparePString(Str255 s1,Str255 s2){short		i;	if (s1[0] == s2[0]) {			// ist die LŠnge gleich?		i = s1[0];					// LŠnge der Strings		while(i) {			if (s1[i] != s2[i])				return(false);		// String sind ungleich			--i;		}		return(true);				// String sind gleich	} else		return(false);				// ungleiche LŠnge => ungleiche Strings}