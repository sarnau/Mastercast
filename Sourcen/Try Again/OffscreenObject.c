/*** *	Klasse zum offscreen Zeichnen * *	©1994 Dekotec Abt. Info-Sys, Markus Fritze ***/#include "OffscreenObject.h"#include <MacWindows.h>void		OffscreenObject::SetDestRect(Rect *iRect){	destrect = *iRect;}Boolean		OffscreenObject::Failed(void){	return failed;}OffscreenObject::OffscreenObject(GrafPtr iWindow, Rect *iRect){	srcrect = *iRect;	destrect = *iRect;	gwind = iWindow;	failed = true;	GetGWorld(&port, &gdh);	if(NewGWorld(&gw, 0, iRect, nil, nil, 0L) != noErr)		return;	failed = false;	SetGWorld(gw, nil);	PixMapHandle	pixBase = GetGWorldPixMap(gw);	LockPixels(pixBase);	// Farbtabelle des Windows ermitteln	RGBColor		backColor;	AuxWinHandle	colors;	GetAuxWin(iWindow, &colors);	CTabHandle		awCTable = (*colors)->awCTable;	for(int index = (*awCTable)->ctSize; index >= 0; index--) {		if((*awCTable)->ctTable[index].value != wContentColor)	// Hintergrundfarbe suchen			continue;			// nicht gefunden => weitersuchen		backColor = (*awCTable)->ctTable[index].rgb;	// Farbe aus der Tabelle kopieren		break;					// und abbrechen	}	RGBColor		saveBackCol;	GetBackColor(&saveBackCol);	RGBBackColor(&backColor);	// gefundene Hintergrundfarbe setzen	// Infozeile lšschen	EraseRect(iRect);				// GWorld mit Hintergrundfarbe lšschen	RGBBackColor(&saveBackCol);}OffscreenObject::~OffscreenObject(){	SetGWorld(port, gdh);	if(failed)					// Allozierung hatte nicht geklappt => raus		return;	SetPort(gwind);	RGBColor	saveFore, saveBack;	GetForeColor(&saveFore);	GetBackColor(&saveBack);	ForeColor(blackColor);	BackColor(whiteColor);	PixMapHandle	pixBase = GetGWorldPixMap(gw);	short	mode = srcCopy;	if(!EqualRect(&srcrect, &destrect))		mode = ditherCopy;	CopyBits((BitMap*)*pixBase, &gwind->portBits, &srcrect, &destrect, mode, nil);	RGBForeColor(&saveFore);	RGBBackColor(&saveBack);	DisposeGWorld(gw);}